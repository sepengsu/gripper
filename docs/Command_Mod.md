# Modbus RTU 기반 통신 정리본

이 파일은 **Modbus RTU** 방식으로 DH-Robotics AG 시리즈 그리퍼를 제어하기 위한 통신 프로토콜과 주요 명령어를 정리한 문서입니다.

---

## 1. 통신 시스템

(Modbus RTU는 RS-485 기반의 직렬 통신 방식으로, 마스터/슬레이브 구조를 가짐)

---

## 2. 전송 기본 방법 (RTU 프레임 구조)

| 필드            | 길이   | 설명                                                                 |
|----------------|--------|----------------------------------------------------------------------|
| Slave Address  | 1바이트 | 기본값: `0x01`                                                       |
| Function Code  | 1바이트 | `0x03`, `0x06`, `0x10` 등 사용                                       |
| Register Addr  | 2바이트 | 읽거나 쓸 레지스터 주소                                              |
| Register Data  | 2바이트 | 해당 레지스터에 쓸 값 또는 읽은 값                                   |
| CRC Checksum   | 2바이트 | 오류 검출을 위한 체크섬 (Low Byte 먼저 전송)                         |

---

### 2.1. 예시

```
01 06 01 00 00 A5 48 4D
```

| 바이트         | 의미                                    |
|----------------|-----------------------------------------|
| `01`           | 슬레이브 주소 (기본값 1)                |
| `06`           | Function Code = 단일 레지스터 쓰기      |
| `01 00`        | 레지스터 주소 = 초기화 명령             |
| `00 A5`        | 데이터 값 = 전체 초기화 실행            |
| `48 4D`        | CRC 체크섬 (Low-High 순)                |

---

## 3. 주요 기능 및 명령어 요약

| 기능               | 주소 (`0x`) | 설명                              | 명령 예시 (Hex) |
|--------------------|-------------|-----------------------------------|------------------|
| 초기화 (Init)      | `0100`      | `0x01` = Init, `0xA5` = Full Init | `01 06 01 00 00 A5 48 4D` |
| 파지 힘 설정       | `0101`      | 값: 20~100 (%)                    | `01 06 01 01 1E 59 FE` (30%) |
| 위치 설정          | `0103`      | 값: 0~1000 (‰)                    | `01 06 01 03 01 F4 78 21` (500‰) |
| 초기화 여부 확인   | `0200`      | `0`: 미초기화, `1`: 초기화 완료  | `01 03 02 00 00 01 85 B2` |
| 현재 상태 읽기     | `0201`      | `0`: 이동 중, `2`: 파지 성공 등  | `01 03 02 01 00 01 D4 72` |
| 현재 위치 읽기     | `0202`      | 현재 위치 상태 반환              | `01 03 02 02 00 01 24 72` |
| 슬레이브 주소 설정 | `0302`      | 기본값: `0x01`, 범위: 1~247       | `01 06 03 02 00 01 E9 8E` |
| BaudRate 설정     | `0303`      | `0~5` = 115200 ~ 4800bps          | `01 06 03 03 00 00 79 8E` |
| Parity 설정        | `0305`      | `0: None`, `1: Odd`, `2: Even`    | `01 06 03 05 00 00 99 8F` |

---

## 4. I/O 모드 구성 및 제어

### 4.1. 설정 레지스터

| 레지스터 주소 | 기능                       | 값 범위       |
|---------------|----------------------------|----------------|
| `0402`        | I/O 모드 활성화/비활성화   | `0`: OFF, `1`: ON |
| `0405~0410`   | 각 그룹별 위치/힘 설정     | Pos: 0~1000, Force: 20~100 |

### 4.2. I/O 제어 상태 매핑

#### 입력 핀 제어 → 동작 그룹 선택

| INPUT1 | INPUT2 | 동작 그룹 | 설명                    |
|--------|--------|-----------|--------------------------|
| 0V     | 0V     | Group 4   | 포지션4 + 파지력4        |
| 0V     | NC     | Group 2   | 포지션2 + 파지력2        |
| NC     | 0V     | Group 3   | 포지션3 + 파지력3        |
| NC     | NC     | Group 1   | 포지션1 + 파지력1        |

#### 출력 핀 상태 → 현재 상태 판별

| OUTPUT1 | OUTPUT2 | 상태 설명                    |
|---------|----------|-------------------------------|
| NC      | NC       | 이동 중                        |
| 0V      | NC       | 위치 도달                      |
| NC      | 0V       | 물체 감지 후 정지              |
| 0V      | 0V       | 파지한 물체 낙하됨             |

---

## 5. 통신 설정 요약

| 항목         | 값 (기본값)     |
|--------------|-----------------|
| Slave Address| 1               |
| Baud Rate    | 115200 (Index 0)|
| Data Bits    | 8 bits          |
| Stop Bits    | 1 bit (Index 0) |
| Parity       | None (Index 0)  |

---

## 6. 참고 사항

- 모든 레지스터는 16비트(2바이트) 단위입니다.
- CRC는 반드시 Modbus RTU 표준에 맞춰 계산되어야 합니다.
- `I/O 모드`가 켜져 있을 경우, RTU 명령과 I/O 제어가 **동시에 가능**하지만, **I/O가 우선**합니다.
- 모든 설정 변경 후에는 반드시 `Save Parameter (0x0300)` 레지스터에 `1`을 쓰고, **재시작**해야 반영됩니다.